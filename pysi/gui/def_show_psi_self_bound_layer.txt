def show_psi(self, bound, layer):
    print("Making PSI graph...")

    week_start = 1
    week_end = self.plan_range * 53
    psi_data = []

    if bound not in ["outbound", "inbound"]:
        print("error: 'bound' must be 'outbound' or 'inbound'")
        return

    if layer not in ["demand", "supply"]:
        print("error: 'layer' must be 'demand' or 'supply'")
        return

    def traverse_and_collect(node):
        for child in node.children:
            traverse_and_collect(child)

        if bound == "outbound":
            node_out = self.nodes_outbound.get(node.name)
        else:
            node_out = self.nodes_inbound.get(node.name)

        if node_out:
            collect_psi_data(node, node_out, layer, week_start, week_end, psi_data)

    if bound == "outbound":
        traverse_and_collect(self.root_node_outbound)
    else:
        traverse_and_collect(self.root_node_inbound)

    if not psi_data:
        print("No PSI data to display.")
        return

    print(f"PSI data collected for {len(psi_data)} nodes.")

    # Calendar labeling
    cal = Calendar445(
        start_year=self.plan_year_st,
        plan_range=self.plan_range,
        use_13_months=True,
        holiday_country="JP"
    )
    week_to_yymm_all = cal.get_week_labels()
    max_year = self.plan_year_st + self.plan_range - 1
    week_to_yymm = {w: y for w, y in week_to_yymm_all.items() if int(str(y)[:2]) <= max_year % 100}
    month_end_weeks = [w for w in cal.get_month_end_weeks() if w in week_to_yymm]
    holiday_weeks = [w for w in cal.get_holiday_weeks() if w in week_to_yymm]

    # Plotting
    week_span = week_end - week_start + 1
    fig_width = max(6, min(week_span * 0.08, 18))
    fig_height = max(len(psi_data) * 1.5, 3)

    fig, axs = plt.subplots(len(psi_data), 1, figsize=(fig_width, fig_height), dpi=100)

    if len(psi_data) == 1:
        axs = [axs]

    for ax, (node_name, revenue, profit, profit_ratio, line_plot_data_2I, bar_plot_data_3P, bar_plot_data_0S) in zip(axs, psi_data):
        ax2 = ax.twinx()
        ax.bar(line_plot_data_2I.index, line_plot_data_2I.values, color='r', alpha=0.6, width=1)
        ax.bar(bar_plot_data_3P.index, bar_plot_data_3P.values, color='g', alpha=0.6, width=1)
        ax2.plot(bar_plot_data_0S.index, bar_plot_data_0S.values, color='b')

        ax.set_ylabel('I&P Lots', fontsize=10)
        ax2.set_ylabel('S Lots', fontsize=10)
        ax.set_title(f'Node: {node_name} | REVENUE: {revenue:,} | PROFIT: {profit:,} | PROFIT_RATIO: {profit_ratio}%', fontsize=10)

        ax.set_xlim(week_start, week_end)
        ax.set_xticks(list(week_to_yymm.keys()))
        ax.set_xticklabels(list(week_to_yymm.values()), rotation=45, fontsize=8)

        for week in month_end_weeks:
            ax.axvspan(week - 0.5, week + 0.5, color='gray', alpha=0.1)

    fig.tight_layout(pad=0.5)

    # Clean previous widgets
    for widget in self.scrollable_frame.winfo_children():
        widget.destroy()

    canvas_psi = FigureCanvasTkAgg(fig, master=self.scrollable_frame)
    canvas_psi.draw()
    canvas_psi.get_tk_widget().pack(fill=tk.BOTH, expand=True)

    # Ensure scroll region is properly updated
    self.scrollable_frame.update_idletasks()
    self.canvas_psi.configure(scrollregion=self.canvas_psi.bbox("all"))

    print("PSI graph display updated.")


